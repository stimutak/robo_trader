## Project Intelligence Guide — Robo Trader

### Project: Robo Trader
**Mission**: Build a safe, testable, risk-managed trading framework that connects to IBKR for market data and supports paper trading by default. Emphasize capital preservation, clarity, and reproducibility. Live execution is gated behind explicit approval and strict risk checks.

### Core Philosophy
- **Capital Preservation First**: Risk limits are non-negotiable.
- **Clarity Over Cleverness**: Prefer straightforward, readable code.
- **No Unnecessary Abstraction**: Keep modules small and purpose-driven.
- **Fix In Place**: Improve existing modules before adding new ones.
- **Test Everything**: Especially risk logic, strategies, and integrations.
- **Determinism & Reproducibility**: Same inputs and environment → same results.

### Critical Constraints
#### NEVER DO
- ❌ Execute live trades by default
- ❌ Commit API keys, credentials, or PII
- ❌ Create duplicate files (e.g., `*-v2.py`, `*-enhanced.py`)
- ❌ Add complex frameworks/abstractions for simple tasks
- ❌ Bypass or weaken risk checks (daily loss, symbol exposure, leverage)
- ❌ Promise profits or rely on unverified predictive claims
- ❌ Use `print` debugging in library code (prefer structured logging/tests)

#### ALWAYS DO
- ✅ Search for existing code before adding new modules
- ✅ Keep paper trading as default; guard any live path behind config and explicit approval
- ✅ Enforce strict type hints and readable naming
- ✅ Write tests for new features; keep the test suite green
- ✅ Document the “why” for meaningful changes
- ✅ Validate inputs; handle error/edge cases first
- ✅ Keep functions small with clear responsibilities

### Current Structure
```
robo_trader/
├── robo_trader/
│   ├── __init__.py
│   ├── config.py              # Env-driven configuration
│   ├── ibkr_client.py         # Async ib_insync client wrapper
│   ├── execution.py           # Paper execution simulator
│   ├── risk.py                # Position sizing & exposure checks
│   ├── strategies.py          # SMA crossover example
│   └── runner.py              # Example orchestrator (paper only)
├── tests/
│   ├── test_risk.py
│   └── test_strategies.py
├── requirements.txt
└── pyproject.toml
```

### Tech Stack
- **Language**: Python (>=3.10; dev target 3.13)
- **Data & IO**: pandas, numpy
- **Broker API**: ib_insync (IBKR)
- **Config**: python-dotenv
- **Tests**: pytest

### Development Commands
```bash
# Setup
python3 -m venv .venv && source .venv/bin/activate
pip install -U pip setuptools wheel
pip install -r requirements.txt
pip install -e .

# Tests
pytest -q

# Run example paper-trading loop
python -m robo_trader.runner
```

### Configuration
- All runtime configuration is read via `robo_trader/config.py` from environment variables.
- Defaults are conservative; symbols default to `AAPL,MSFT,SPY`.
- Required envs for IBKR connectivity: `IBKR_HOST`, `IBKR_PORT`, `IBKR_CLIENT_ID`.
- Trading mode: `TRADING_MODE=paper` by default. Live requires explicit change and approval.

### Risk Management
- Implemented in `robo_trader/risk.py`; tested in `tests/test_risk.py`.
- Enforces: max daily loss, per-symbol exposure cap, leverage limit.
- Position sizing uses a fraction of available cash; deterministic calculations.

### Strategy Guidelines
- Example SMA crossover in `robo_trader/strategies.py` with tests.
- Signals must be pure functions (Input → Output; no side effects).
- Add strategies only when interactions with risk are clear and tested.

### Execution Modes
- **Paper (default)**: Simulated fills via `PaperExecutor` in `execution.py`.
- **Live (explicit opt-in only)**: Must pass all safeguards below.

### Testing Requirements
- Run unit tests before any commit; keep test suite fast and deterministic.
- Add/extend tests for risk logic, order validation, and new strategies.
- Cover edge cases: zero/negative prices, invalid quantities, exposure limits, leverage caps.

### Security Checklist
- [ ] API keys only via environment variables
- [ ] Never commit `.env` or secrets
- [ ] Sanitize logs (no PII/secrets)
- [ ] Respect IBKR pacing/rate limits when added
- [ ] Pin or vet dependencies regularly

### Git Workflow
1. Branch from main: `feature/short-description`
2. Use semantic commits with concise rationale
3. Keep tests green locally before PR
4. Squash merge to main

### Implementation Planning
- **Primary Plan**: `IMPLEMENTATION_PLAN.md` - 16-week phased approach to transform system into ML-driven platform
- Based on GPT5 code review (`GPT5 code review 8-28.md`)
- Four phases: Foundation (1-4), ML Infrastructure (5-8), Strategy Development (9-12), Production (13-16)
- Each task has clear dependencies, time estimates, and success criteria
- Target metrics: Sharpe > 1.5, max drawdown < 10%

### File Creation Policy
- Prefer in-place edits; create new files only when necessary for clarity.
- If adding a new module, document why it exists, expected inputs/outputs, and tests.

### Logging & Observability
- Prefer structured logging (planned) over `print`.
- Keep library code quiet; rely on tests until logging module is introduced.
- When adding logging, centralize with levels and contextual metadata.

### Live Trading Safeguards
- Live execution paths must:
  - Check `TRADING_MODE == "live"` and require explicit user confirmation in PR/commit context
  - Pass all tests and include integration tests or dry-run harnesses
  - Enforce the same risk checks as paper mode
  - Provide clear rollback switches and maximum notional limits

### Code Style
- Descriptive names, explicit types, early returns, narrow responsibilities
- Validate inputs and handle errors first; avoid deep nesting
- Keep formatting consistent; do not reformat unrelated code in edits

### Non-Goals
- Predicting markets or guaranteeing returns
- Building UI or web services unless explicitly requested

---
This document adapts the relevant ALWAYS/NEVER rules, testing discipline, security checklist, and workflow guidance from the provided CLAUDE-style project guide, tailored to Robo Trader’s Python/IBKR trading context. Treat paper mode and risk guardrails as the default operating posture.


